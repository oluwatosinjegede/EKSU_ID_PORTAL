{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4">

    <h2 class="text-3xl font-bold mb-8">Student Dashboard</h2>

    <!-- SUMMARY CARDS -->
    <div class="grid md:grid-cols-3 gap-6 mb-10">

        <!-- APPLY -->
        <div class="bg-white p-6 rounded-xl shadow">
            <h3 class="font-semibold mb-2">Apply for ID Card</h3>
            <p class="text-sm text-gray-600 mb-4">
                Submit your passport photograph only.
            </p>

            {% if not application %}
                <a href="{% url 'accounts:apply_id' %}"
                   class="text-blue-700 font-semibold hover:underline">
                    Apply
                </a>
            {% else %}
                <span class="text-gray-500 text-sm">
                    Application submitted
                </span>
            {% endif %}
        </div>

        <!-- STATUS -->
        <div class="bg-white p-6 rounded-xl shadow">
            <h3 class="font-semibold mb-2">Application Status</h3>

            {% if application %}
                <span class="inline-block px-3 py-1 rounded-full text-sm font-semibold
                    {% if application.status == 'APPROVED' %}
                        bg-green-100 text-green-700
                    {% elif application.status == 'PENDING' or application.status == 'UNDER_REVIEW' %}
                        bg-yellow-100 text-yellow-700
                    {% else %}
                        bg-gray-100 text-gray-700
                    {% endif %}
                ">
                    {{ application.status|capfirst }}
                </span>
            {% else %}
                <span class="text-gray-500 text-sm">Not Applied</span>
            {% endif %}
        </div>

        <!-- ID CARD -->
        <div class="bg-white p-6 rounded-xl shadow">
            <h3 class="font-semibold mb-2">My ID Card</h3>

            {% if id_card %}

                
                {% if id_card.image and id_card.image.url %}
                    <img
                        src="{{ id_card.image.url }}"
                        alt="Student ID Card"
                        class="border rounded mb-4 w-full max-w-xs mx-auto"
                    >

                    <a href="{% url 'idcards:download_id' id_card.uid %}"
                       class="inline-block bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-800 transition">
                        Download ID Card
                    </a>

                {# ===============================
                   FAILOVER STREAM MODE
                   =============================== #}
                {% else %}
                    <img
                        src="{% url 'idcards:view_id_stream' id_card.uid %}"
                        alt="Student ID Card"
                        class="border rounded mb-4 w-full max-w-xs mx-auto"
                    >

                    <a href="{% url 'idcards:download_id_stream' id_card.uid %}"
                       class="inline-block bg-blue-700 text-white px-4 py-2 rounded hover:bg-blue-800 transition">
                        Download ID Card
                    </a>
                {% endif %}

            {% else %}
                <p class="text-gray-500">
                    Your ID card is not yet available.
                </p>
            {% endif %}
        </div>

    </div>

    <!-- APPLICATION TIMELINE -->
    <div class="bg-white rounded-xl shadow p-6 mb-10">
        <h3 class="text-xl font-bold mb-8">Application Progress</h3>

        <div class="relative flex justify-between items-center">
            <div class="absolute top-5 left-0 right-0 h-1 bg-gray-200"></div>

            <div class="relative text-center w-1/4">
                <div class="mx-auto w-10 h-10 rounded-full flex items-center justify-center
                    {% if timeline.applied %}bg-green-600{% else %}bg-gray-300{% endif %}
                    text-white font-bold">1</div>
                <p class="mt-2 text-sm font-semibold">Applied</p>
            </div>

            <div class="relative text-center w-1/4">
                <div class="mx-auto w-10 h-10 rounded-full flex items-center justify-center
                    {% if timeline.review %}bg-blue-600{% else %}bg-gray-300{% endif %}
                    text-white font-bold">2</div>
                <p class="mt-2 text-sm font-semibold">Under Review</p>
            </div>

            <div class="relative text-center w-1/4">
                <div class="mx-auto w-10 h-10 rounded-full flex items-center justify-center
                    {% if timeline.approved %}bg-indigo-600{% else %}bg-gray-300{% endif %}
                    text-white font-bold">3</div>
                <p class="mt-2 text-sm font-semibold">Approved</p>
            </div>

            <div class="relative text-center w-1/4">
                <div class="mx-auto w-10 h-10 rounded-full flex items-center justify-center
                    {% if timeline.issued %}bg-green-700{% else %}bg-gray-300{% endif %}
                    text-white font-bold">4</div>
                <p class="mt-2 text-sm font-semibold">ID Issued</p>
            </div>
        </div>

        <div class="mt-6 text-sm">
            {% if timeline.issued %}
                <p class="text-green-700 font-semibold">
                    Your ID card has been issued and is ready for download.
                </p>
            {% elif timeline.approved %}
                <p class="text-blue-700">
                    Application approved. ID card is being generated.
                </p>
            {% elif timeline.review %}
                <p class="text-yellow-600">
                    Your application is currently under review.
                </p>
            {% elif timeline.applied %}
                <p class="text-gray-600">
                    Application submitted successfully.
                </p>
            {% else %}
                <p class="text-red-600">
                    You have not applied for an ID card yet.
                </p>
            {% endif %}
        </div>

    </div>

</div>
{% endblock %}
